# trigger:
# - staging

variables:
  # Container registry service connection established during pipeline creation
  dockerRegistryServiceConnection: '79c65186-8e8d-4f44-bf61-a68591824e25'
  imageRepository: 'gliffaistore'
  containerRegistry: 'gliff.azurecr.io'
  dockerfilePath: '$(Build.SourcesDirectory)/Dockerfile'
  tag: 'latest'

  # Agent VM image name
  vmImageName: 'ubuntu-latest'
    
stages:
- stage: Build
  displayName: Build and push stage

  jobs:
    - deployment: VMDeploy
      displayName: web
      pool:
        vmImage: 'ubuntu-latest'
      environment:
        name: Staging
        resourceType: VirtualMachine
      strategy:
        runOnce:
          deploy:
            steps:
              - script: TAG=${variables.tag} docker-compose -d up